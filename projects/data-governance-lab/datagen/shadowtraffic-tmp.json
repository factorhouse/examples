{
  "generators": [
    {
      "name": "users",
      "table": "users",
      "fork": {
        "key": { "_gen": "uuid" }
      },
      "row": {
        "user_id": {
          "_gen": "var",
          "pgHint": "UUID PRIMARY KEY",
          "var": "forkKey"
        }
      },
      "stateMachine": {
        "_gen": "stateMachine",
        "initial": "insertIt",
        "transitions": {
          "insertIt": "updateIt"
        },
        "states": {
          "insertIt": {
            "row": {
              "first_name": { "_gen": "string", "expr": "#{Name.firstName}" },
              "last_name": { "_gen": "string", "expr": "#{Name.lastName}" },
              "email": { "_gen": "string", "expr": "#{Internet.emailAddress}" },
              "country": {
                "_gen": "oneOf",
                "choices": ["USA", "Germany"]
              },
              "postal_code": { "_gen": "string", "expr": "#{Address.zipCode}" },
              "created_at": {
                "_gen": "now",
                "pgHint": "TIMESTAMP",
                "serialize": { "type": "postgresTimestamp" }
              },
              "updated_at": {
                "_gen": "now",
                "pgHint": "TIMESTAMP",
                "serialize": { "type": "postgresTimestamp" }
              }
            }
          },
          "updateIt": {
            "op": "update",
            "where": {
              "user_id": { "_gen": "var", "var": "forkKey" }
            },
            "row": {
              "postal_code": { "_gen": "string", "expr": "#{Address.zipCode}" },
              "updated_at": {
                "_gen": "now",
                "pgHint": "TIMESTAMP",
                "serialize": { "type": "postgresTimestamp" }
              }
            }
          }
        }
      }
    },
    {
      "name": "orders",
      "table": "orders",
      "row": {
        "order_id": {
          "_gen": "uuid",
          "pgHint": "UUID"
        },
        "user_id": {
          "_gen": "lookup",
          "table": "users",
          "path": ["row", "user_id"]
        },
        "created_at": {
          "_gen": "now",
          "pgHint": "TIMESTAMP",
          "serialize": { "type": "postgresTimestamp" }
        },
        "updated_at": {
          "_gen": "now",
          "pgHint": "TIMESTAMP",
          "serialize": { "type": "postgresTimestamp" }
        }
      }
    }
  ],
  "connections": {
    "pg-db": {
      "kind": "postgres",
      "connectionConfigs": {
        "host": "postgres",
        "port": 5432,
        "username": "db_user",
        "password": "db_password",
        "db": "fh_dev"
      },
      "tablePolicy": "dropAndCreate",
      "batchConfigs": {
        "lingerMs": 500,
        "batchRows": 5000
      }
    }
  }
}
